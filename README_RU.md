# Wowhead Tooltips Shortcode для WordPress

**Версия:** 3.0.0
**Автор:** Ваше Имя
**URI Автора:** https://your-website.com

Плагин "Wowhead Tooltips Shortcode" позволяет легко вставлять на ваш сайт WordPress ссылки на различные игровые объекты, заклинания, NPC, квесты и многое другое из базы данных Wowhead, с автоматически появляющимися всплывающими подсказками при наведении. Плагин поддерживает различные версии игры World of Warcraft (Retail, Classic, WotLK Classic и др.) и множество языков.

## Возможности

* Отображение всплывающих подсказок Wowhead для различных игровых сущностей.
* [cite_start] Поддержка Retail, Classic (Era, SoD), TBC Classic, WotLK Classic, Cataclysm Classic, MoP Classic, PTR и Beta версий игры. 
* [cite_start] Поддержка множества языков, включая русский, английский, немецкий, французский, испанский и другие. 
* Автоматическое определение языка на основе настроек WordPress или явное указание языка в шорткоде.
* Возможность задавать собственный текст для ссылок.
* Возможность изменять цвет и стиль ссылок.
* Иконки для ссылок автоматически добавляются скриптом Wowhead (размер по умолчанию 'tiny').
* Получение названий объектов из XML-фида Wowhead, если они не указаны в шорткоде.
* Кэширование XML-ответов для повышения производительности и снижения нагрузки на серверы Wowhead.
* Простая интеграция с помощью шорткода `[wowhead]`.

## Установка

1.  Загрузите папку с плагином (`wowhead-tooltips-shortcode` или аналогичную) в директорию `/wp-content/plugins/` вашего сайта WordPress.
    * Или загрузите ZIP-архив плагина через раздел "Плагины" > "Добавить новый" > "Загрузить плагин" в вашей панели администратора WordPress.
2.  Активируйте плагин через меню "Плагины" в WordPress.

## Использование

Плагин предоставляет шорткод `[wowhead]`, который можно вставлять в записи, на страницы или в виджеты вашего сайта.

### Базовый синтаксис

[wowhead id="параметры_объекта"]

### Основные атрибуты шорткода

* **`id`** (обязательный): Строка, содержащая информацию об объекте Wowhead и его параметры. Внутри этой строки параметры разделяются амперсандом (`&`).
    *  **Тип объекта и его ID:** Например, `item=19019` (предмет), `spell=33786` (заклинание), `quest=10129` (квест), `npc=16060` (NPC) и т.д.   Полный список поддерживаемых типов можно найти в файле `edit.txt` плагина или в документации Wowhead. 
    * **`domain`**: (необязательный параметр внутри `id`) Определяет язык и/или версию игры.
        * Примеры: `domain=ru` (русский Retail), `domain=classic` (английский Classic), `domain=ru.wotlk` (русский WotLK Classic), `domain=fr.cata` (французский Cataclysm Classic).
        * Если `domain` не указан, плагин попытается использовать язык вашего сайта WordPress (если он поддерживается для Retail Wowhead). Если и это невозможно, будет использован английский язык для Retail.
        *  Плагин пытается исправить некорректные форматы, например, `classic.ru` будет обработан как `ru.classic`. 
    *  **Дополнительные параметры Wowhead:** Могут быть добавлены для уточнения объекта, например, `gems=...`, `ench=...`, `pcs=...` для предметов. 
* **`name`** (необязательный): Позволяет задать собственный текст для отображаемой ссылки.
    * Пример: `name="Мой любимый меч"`
    * Если `name` не указан, плагин попытается получить официальное название объекта из XML-фида Wowhead. Если и это не удастся, будет использовано стандартное имя (например, "Item 19019").
    * При использовании атрибута `name`, опция `renameLinks` для скрипта Wowhead будет автоматически установлена в `false` для всей страницы, чтобы ваши кастомные имена не перезаписывались.
* **`color`** (необязательный): Позволяет задать цвет текста ссылки.
    * Может быть CSS-именем цвета (например, `color="green"`), HEX-кодом (например, `color="#FF0000"`) или именем CSS-класса, который вы определили в своих стилях (например, `color="my-custom-color-class"`).
    * При использовании атрибута `color` (или `style`), опция `colorLinks` для скрипта Wowhead будет автоматически установлена в `false` для всей страницы, чтобы ваши кастомные цвета не перезаписывались стандартными цветами Wowhead.
* **`style`** (необязательный): Позволяет применить произвольные инлайн CSS-стили к ссылке.
    * Пример: `style="font-weight: bold; text-decoration: underline;"`
    * Как и с атрибутом `color`, использование `style` установит `colorLinks: false` для всей страницы.

**Примечание по иконкам:** В данной версии плагина (`v3.0.0`) размер иконок по умолчанию установлен на `'tiny'` для всех ссылок Wowhead на странице. Атрибут `icon` в шорткоде **игнорируется** для упрощения и обеспечения стабильной работы. Иконки добавляются автоматически скриптом Wowhead, если `iconizeLinks` включено (что по умолчанию `true`).

### Примеры использования

#### 1. Основные типы объектов (язык и версия по умолчанию - Retail, английский, если язык сайта не русский/немецкий и т.д.)

* **Предмет:**
    `[wowhead id="item=19019"]` (отобразит Громовую Ярость)
* **Заклинание:**
    `[wowhead id="spell=33786"]` (отобразит Смерч)
* **Задание:**
    `[wowhead id="quest=10129"]`
* **Достижение:**
    `[wowhead id="achievement=621"]`
* **NPC:**
    `[wowhead id="npc=16060"]`
* **Зона:**
    `[wowhead id="zone=3703"]`

#### 2. Указание языка (на примере Retail)

* **Русский:**
    `[wowhead id="item=19019&domain=ru"]`
* **Немецкий:**
    `[wowhead id="item=19019&domain=de"]`
* **Французский:**
    `[wowhead id="item=19019&domain=fr"]`
* **Испанский:**
    `[wowhead id="item=19019&domain=es"]`

#### 3. Указание версии игры (язык по умолчанию - английский, если язык сайта не совпадает с языком версии)

* **World of Warcraft Classic (английский):**
    `[wowhead id="item=19019&domain=classic"]`
* **WotLK Classic (английский):**
    `[wowhead id="item=49623&domain=wotlk"]`
* **Cataclysm Classic (английский):**
    `[wowhead id="item=71086&domain=cata"]`

#### 4. Комбинация языка и версии игры

* **Русский Classic:**
    `[wowhead id="item=19019&domain=ru.classic"]`
* **Немецкий WotLK Classic (исправленный формат):**
    `[wowhead id="item=49623&domain=de.wotlk"]` (плагин обработает `wotlk.de` как `de.wotlk`)
* **Французский Cataclysm Classic:**
    `[wowhead id="item=71086&domain=fr.cata"]`

#### 5. Использование атрибутов `name`, `color`, `style`

* **Собственное имя ссылки:**
    `[wowhead id="item=19019&domain=ru" name="Легендарный Меч!"]`
* **Зеленый цвет ссылки:**
    `[wowhead id="item=19019&domain=ru" color="green"]`
* **Цвет ссылки через HEX и жирный шрифт:**
    `[wowhead id="item=19019&domain=ru" color="#FF8C00" style="font-weight: bold;"]`
* **Собственный CSS-класс для ссылки:**
    `[wowhead id="item=19019&domain=ru" color="my-custom-wowhead-link"]`
    *(Вам нужно будет определить стиль для `.my-custom-wowhead-link` в CSS вашей темы).*
* **Полный пример с разными атрибутами:**
    `[wowhead id="spell=33786&domain=fr" name="Cyclone (FR)" style="text-transform: uppercase;" color="blue"]`

#### 6. Расширенные параметры Wowhead внутри `id`

Вы можете передавать дополнительные параметры, специфичные для Wowhead, прямо в строке `id`.  Например, для предметов это могут быть камни, зачарования, бонусы от комплекта и т.д. 

* **Предмет с камнем и зачарованием (пример):**
    `[wowhead id="item=25697&domain=tbc&gems=23121&ench=2647"]`
* **Предмет с бонусами от комплекта (пример):**
    `[wowhead id="item=25697&domain=tbc&pcs=25695:25697"]`

#### 7. Пустые или некорректные шорткоды

* **Пустой шорткод `[wowhead]` или `[wowhead id=""]`:**
    Отобразит простую ссылку на главную страницу Wowhead (с учетом языка сайта, если применимо).
* **Шорткод с несуществующим ID или некорректными данными:**
    `[wowhead id="item=999999999"]`
    Отобразит ссылку "Wowhead.com (unavailable)" красного цвета.
* **Шорткод только с доменом:**
    `[wowhead id="domain=ru.classic"]`
    Отобразит ссылку на главную страницу Wowhead для указанного домена.

## Приоритет определения языка и версии

1.  **Явное указание в шорткоде:** Параметр `domain` в атрибуте `id` имеет наивысший приоритет.
2.  **Язык сайта WordPress:** Если `domain` не указан, плагин использует язык вашего сайта WordPress для Retail-версии Wowhead (если этот язык поддерживается).
3.  **Английский язык по умолчанию:** Если ни один из вышеуказанных методов не применим, используется английский язык для Retail-версии Wowhead.

## Кэширование

Плагин кэширует ответы от XML-фидов Wowhead (имена объектов, статус 404) на 12 часов для успешных запросов и на 1 час для ошибок 404. Это помогает уменьшить количество запросов к серверам Wowhead и ускорить загрузку ваших страниц.

## Устранение неполадок

* **Подсказки не появляются:**
    1.  Убедитесь, что плагин активен.
    2.  Убедитесь, что на странице есть хотя бы один шорткод `[wowhead]`.
    3.  Проверьте исходный HTML-код страницы (Ctrl+U): должны присутствовать строки `const whTooltips = {...};` и `<script src="https://wow.zamimg.com/widgets/power.js"></script>` ближе к концу страницы, перед `</body>`.
    4.  Проверьте консоль JavaScript вашего браузера (F12 -> Console) на наличие ошибок.
    5.  Убедитесь, что в файле `footer.php` вашей темы присутствует вызов `<?php wp_footer(); ?>`.
    6.  Попробуйте временно отключить другие плагины и переключиться на стандартную тему WordPress, чтобы исключить конфликты.
    7.  Очистите все уровни кэша (браузер, плагины WordPress, серверный кэш, CDN).
* **Неправильный язык или версия игры:** Внимательно проверьте значение параметра `domain` в вашем шорткоде.

## Список поддерживаемых сущностей (основные типы для `id`)

Плагин ориентирован на основные сущности, для которых Wowhead предоставляет тултипы. Наиболее часто используемые:
 `item`, `spell`, `quest`, `achievement`, `npc`, `zone`, `currency`, `faction`, `pet`, `itemset`, `skill`, `mount`, `outfit`, `event`, `object`, `transmog`, `affix`. 

Для более специфических или редких типов сущностей обратитесь к документации Wowhead.

---

Надеемся, этот плагин будет полезен для вашего сайта!