=== Wowhead Tooltips Shortcode ===
Contributors: Strogino
Donate link: https://pro-wow.ru/
Tags: wowhead, tooltips, shortcode, world of warcraft, wow, classic, wotlk, cata, mop, retail, подсказки, шорткод, вов
Requires at least: 5.0
Tested up to: 6.8
Requires PHP: 7.4
Stable tag: 3.1.1
License: GPLv2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html

Легко отображайте интерактивные всплывающие подсказки Wowhead для предметов, заклинаний, квестов, NPC и многого другого в WoW с помощью простого шорткода. Поддерживает разные версии игры и языки.

== Описание ==

Плагин "Wowhead Tooltips Shortcode" позволяет вам легко интегрировать многофункциональные интерактивные всплывающие подсказки Wowhead в ваши записи и страницы WordPress. Используя простой шорткод `[wowhead]`, вы можете ссылаться на различные игровые сущности, такие как предметы, заклинания, задания, достижения, NPC и зоны из любого дополнения World of Warcraft, включая Retail, Classic Era, WotLK Classic, Cataclysm Classic и Mists of Pandaria Classic/Remix.

Плагин разработан с упором на гибкость и предлагает поддержку множества языков (например, русский, английский, немецкий, французский, китайский, корейский) и версий игры. Он интеллектуально определяет язык и версию на основе настроек вашего WordPress или позволяет явно указать их через шорткод. Ключевые функции включают установку собственного текста для ссылок, настройку цвета и стиля ссылок, а также автоматическое отображение иконок (размер зафиксирован как 'tiny' для единообразия). Для обеспечения точности и производительности официальные названия сущностей извлекаются из XML-фида Wowhead и кэшируются локально с помощью WordPress Transients.

Этот инструмент идеально подходит для фан-сайтов, сайтов гильдий или для любого создателя контента, который хочет предоставить насыщенную контекстную информацию из Wowhead непосредственно в своем контенте.

== Возможности ==

* Отображение официальных всплывающих подсказок Wowhead для широкого спектра сущностей World of Warcraft.
* Поддержка нескольких версий игры:
    * Retail (Актуальная версия)
    * Classic Era / Сезон Открытий
    * The Burning Crusade Classic (TBC)
    * Wrath of the Lich King Classic (WotLK)
    * Cataclysm Classic (Cata)
    * Mists of Pandaria Classic (MoP) / Remix
    * Public Test Realm (PTR / Тестовый игровой мир)
    * Beta-серверы
* Обширная языковая поддержка, включая русский (по умолчанию для русскоязычных сайтов), английский, немецкий, французский, испанский, итальянский, португальский, корейский, китайский (упрощенный) и китайский (традиционный).
* Автоматическое определение языка на основе настроек сайта WordPress, с возможностью явного указания языка и версии игры в каждом шорткоде.
* Позволяет пользователям задавать собственный текст для ссылок.
* Позволяет пользователям настраивать цвет ссылок и применять пользовательские CSS-стили.
* Иконки для ссылок автоматически добавляются скриптом Wowhead (размер по умолчанию 'tiny' для всех иконок на странице).
* Получение официальных названий сущностей из XML-фида Wowhead, если они не указаны в шорткоде.
* Кэширование XML-ответов с помощью WordPress Transients API для улучшения производительности и снижения нагрузки на серверы Wowhead.
* Простая интеграция с помощью шорткода `[wowhead]`.

== Установка ==

1.  **Загрузка через админ-панель WordPress:**
    * Скачайте ZIP-архив плагина с [репозитория GitHub](https://github.com/pro-wow/wowhead-tooltips/).
    * В вашей админ-панели WordPress перейдите в "Плагины" > "Добавить новый".
    * Нажмите "Загрузить плагин" вверху страницы.
    * Выберите скачанный ZIP-файл и нажмите "Установить".
    * Активируйте плагин.
2.  **Ручная загрузка:**
    * Скачайте и распакуйте ZIP-архив плагина.
    * Загрузите папку плагина (например, `wowhead-tooltips`) в директорию `/wp-content/plugins/` на вашем сервере.
    * Активируйте плагин через меню "Плагины" в WordPress.
3.  **Создание папки `languages`:**
    * Для интернационализации убедитесь, что в корневой директории плагина существует папка `languages` (например, `/wp-content/plugins/wowhead-tooltips/languages/`). Плагин использует `wowhead-tooltips` в качестве своего текстового домена.

== Использование ==

Плагин предоставляет шорткод `[wowhead]`, который можно вставлять в записи, на страницы или в виджеты WordPress.

=== Базовый синтаксис ===

`[wowhead id="строка_параметров_сущности"]`

=== Атрибуты шорткода ===

Шорткод принимает несколько атрибутов для настройки его поведения и внешнего вида:

* **`id`** (обязательный):
    * Строка, содержащая информацию о сущности Wowhead и ее специфические параметры.
    * Параметры внутри этой строки разделяются амперсандом (`&`).
    * **Тип сущности и ID:** Должен включать тип сущности и ее числовой ID (например, `item=19019`, `spell=33786`, `quest=10129`).
    * **`domain`** (необязательный, внутри строки `id`): Указывает язык и/или версию игры для всплывающей подсказки.
        * Примеры: `domain=ru` (русский Retail), `domain=classic` (английский Classic), `domain=de.wotlk` (немецкий WotLK Classic).
        * Если опущен, плагин пытается использовать язык сайта WordPress для Retail Wowhead. Если он не поддерживается, по умолчанию используется английский Retail.
        * Плагин пытается исправить распространенные ошибки формата, такие как `версия.язык`, приводя их к ожидаемому `язык.версия`.
    * **Дополнительные параметры Wowhead:** Могут быть включены другие параметры, распознаваемые Wowhead (например, `gems=...`, `ench=...`, `pcs=...` для предметов).
* **`name`** (необязательный):
    * Устанавливает пользовательский текст для отображаемой ссылки.
    * Пример: `name="Мой потрясающий предмет"`
    * Если не указан, плагин попытается получить официальное название через XML-фид Wowhead. Если это не удастся, будет использовано общее имя (например, "Предмет 19019").
    * **Примечание:** Использование этого атрибута установит глобальную опцию `renameLinks` в `whTooltips` в `false` для страницы, предотвращая перезапись пользовательских названий ссылок скриптом Wowhead.
* **`color`** (необязательный):
    * Устанавливает цвет текста ссылки.
    * Принимает CSS-названия цветов (например, `color="green"`), HEX-коды (например, `color="#FF8C00"`) или имя пользовательского CSS-класса, определенного в стилях вашей темы (например, `color="my-custom-link-class"`).
    * **Примечание:** Использование этого атрибута (или `style`) установит глобальную опцию `colorLinks` в `whTooltips` в `false` для страницы, предотвращая применение стандартных цветов качества скриптом Wowhead.
* **`style`** (необязательный):
    * Применяет пользовательские инлайн CSS-стили к ссылке.
    * Пример: `style="font-weight: bold; text-decoration: underline;"`
    * Использование этого атрибута также устанавливает `colorLinks: false` глобально для страницы.

**Важное примечание по иконкам:**
В этой версии плагина размер иконок (`iconSize`) для всех всплывающих подсказок Wowhead на странице зафиксирован как `'tiny'`. Атрибут `icon` в шорткоде **игнорируется** для установки `iconSize`. Иконки автоматически добавляются скриптом Wowhead `power.js`, если опция `iconizeLinks` в объекте `whTooltips` включена (что является поведением по умолчанию).

=== Как плагин определяет глобальные опции `whTooltips` ===

Плагин настраивает глобальный JavaScript-объект `whTooltips` на основе атрибутов, использованных в *любом* из шорткодов `[wowhead]` на текущей странице:

* `iconSize`: Всегда устанавливается в `'tiny'`.
* `renameLinks`: Устанавливается в `false`, если хотя бы один шорткод на странице использует атрибут `name`; в противном случае `true`.
* `colorLinks`: Устанавливается в `false`, если хотя бы один шорткод на странице использует атрибут `color` или `style`; в противном случае `true`.
* `iconizeLinks`: Всегда устанавливается в `true`.

=== Примеры ===

==== 1. Основные типы объектов ====
(Язык/версия по умолчанию: Retail English, если язык сайта не является поддерживаемым языком Wowhead для Retail)

* **Предмет:**
    `[wowhead id="item=19019"]`
* **Заклинание:**
    `[wowhead id="spell=33786"]`
* **Задание:**
    `[wowhead id="quest=10129"]`

==== 2. Указание языка (пример для Retail) ====

* **Русский:**
    `[wowhead id="item=19019&domain=ru"]`
* **Немецкий:**
    `[wowhead id="item=19019&domain=de"]`

==== 3. Указание версии игры (язык по умолчанию: английский) ====

* **World of Warcraft Classic:**
    `[wowhead id="item=19019&domain=classic"]`
* **WotLK Classic:**
    `[wowhead id="item=49623&domain=wotlk"]`

==== 4. Комбинация версии игры и языка ====

* **Русский Classic:**
    `[wowhead id="item=19019&domain=ru.classic"]`
* **Немецкий WotLK Classic:**
    `[wowhead id="item=49623&domain=de.wotlk"]`

==== 5. Использование атрибутов `name`, `color`, `style` ====

* **Пользовательское название ссылки:**
    `[wowhead id="item=19019&domain=ru" name="Легендарный Меч!"]`
* **Зеленый цвет ссылки:**
    `[wowhead id="item=19019&domain=ru" color="green"]`
* **Цвет ссылки через HEX и жирный шрифт:**
    `[wowhead id="item=19019&domain=ru" color="#FF8C00" style="font-weight: bold;"]`
* **Пользовательский CSS-класс для ссылки:**
    `[wowhead id="item=19019&domain=ru" color="my-custom-wowhead-link"]`
    *(Вам нужно будет определить стиль для `.my-custom-wowhead-link` в CSS вашей темы).*

==== 6. Расширенные параметры Wowhead внутри `id` ====

Вы можете передавать дополнительные специфичные для Wowhead параметры прямо в строке `id`. Для предметов это могут быть камни, зачарования, бонусы от комплекта и т.д.

* **Предмет с камнем и зачарованием (Пример):**
    `[wowhead id="item=25697&domain=tbc&gems=23121&ench=2647"]`

==== 7. Пустые или некорректные шорткоды ====

* **Пустой шорткод `[wowhead]` или `[wowhead id=""]`:**
    Отобразит простую ссылку на главную страницу Wowhead (с учетом языка сайта, если применимо).
* **Шорткод с несуществующим ID или некорректными данными:**
    `[wowhead id="item=999999999"]`
    Отобразит ссылку "Wowhead.com (unavailable)" красного цвета.
* **Шорткод только с доменом:**
    `[wowhead id="domain=ru.classic"]`
    Отобразит ссылку на главную страницу Wowhead для указанного домена.

== Приоритет определения языка и версии ==

1.  **Явное указание в шорткоде:** Параметр `domain` в атрибуте `id` имеет наивысший приоритет.
2.  **Язык сайта WordPress:** Если `domain` не указан, плагин использует язык вашего сайта WordPress для Retail-версии Wowhead (если этот язык поддерживается).
3.  **Английский по умолчанию:** Если ни один из вышеуказанных методов не применим, используется английский язык для Retail-версии Wowhead.

== Кэширование ==

Плагин кэширует ответы от XML-фидов Wowhead (названия объектов, статус 404) на 12 часов для успешных запросов и на 1 час для ошибок 404, используя WordPress Transients API. Это помогает уменьшить количество запросов к серверам Wowhead и ускоряет загрузку ваших страниц.

== Устранение неполадок ==

* **Всплывающие подсказки не появляются / Иконки отсутствуют:**
    1.  Убедитесь, что плагин активен.
    2.  Убедитесь, что на странице есть хотя бы один шорткод `[wowhead]`.
    3.  Проверьте исходный HTML-код страницы (Ctrl+U или Cmd+Option+U): строки `const whTooltips = {...};` и `<script src="https://wow.zamimg.com/widgets/power.js"></script>` должны присутствовать ближе к концу страницы, перед `</body>`.
    4.  Проверьте консоль JavaScript вашего браузера (F12 -> Console) на наличие ошибок. Любые ошибки JS могут помешать инициализации скриптов Wowhead.
    5.  Убедитесь, что файл `footer.php` вашей темы содержит вызов `<?php wp_footer(); ?>` перед закрывающим тегом `</body>`.
    6.  Попробуйте временно отключить другие плагины и переключиться на стандартную тему WordPress (например, Twenty Twenty-Three) для исключения конфликтов.
    7.  Очистите все уровни кэша (браузера, плагинов WordPress, серверного кэша, CDN).
* **Некорректный язык или версия игры:** Внимательно проверьте значение параметра `domain` в вашем шорткоде.
* **Ошибки PHP:** Если плагин не активируется или вызывает проблемы, включите отладку WordPress (`WP_DEBUG`, `WP_DEBUG_LOG` в `wp-config.php`), чтобы проверить наличие ошибок PHP в `wp-content/debug.log`.

== Участие в разработке ==

Мы приветствуем ваш вклад! Вы можете сделать форк репозитория на [GitHub](https://github.com/pro-wow/wowhead-tooltips/), внести изменения и отправить pull-запросы.

== Журнал изменений ==

= 3.1.1 =
* Обновлен заголовок плагина для совместимости с WordPress.org (проверка плагином PCP).
* Добавлены комментарии на английском языке в PHP-код (для версии разработки).
* Установлена версия "Проверено до" WordPress до 6.8.
* Стандартизировано название плагина на "Wowhead Tooltips Shortcode".
* Исправлен `Stable tag` для соответствия версии плагина.
* Сокращено краткое описание для соблюдения лимита в 150 символов.

= 3.0.0 =
* Начальная стабильная версия с прямым выводом скриптов Wowhead JS.
* Включено XML-кэширование через Transients API.
* `iconSize` глобально зафиксирован на 'tiny'.
* `renameLinks` и `colorLinks` определяются глобально на основе атрибутов шорткода.
* Комплексная обработка доменов и языков.